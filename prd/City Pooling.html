

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>City Pooling Notebook &mdash; City Pooling 1.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="src" href="apidoc-build/mods.html" />
    <link rel="prev" title="Welcome to City Pooling’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> City Pooling
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">City Pooling Notebook</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Problem-statement">Problem statement</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Why-does-this-problem-seem-interesting-to-me?">Why does this problem seem interesting to me?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Disclaimer">Disclaimer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Imports">Imports</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Geography">Geography</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#What-for?">What for?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Class-definition">Class definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Examples">Examples</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Constructor-and-show-method">Constructor and <code class="docutils literal notranslate"><span class="pre">show</span></code> method</a></li>
<li class="toctree-l4"><a class="reference internal" href="#show_config-method"><code class="docutils literal notranslate"><span class="pre">show_config</span></code> method</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#Random-and-optimal-solution-to-the-meshgrid-problem">Random and optimal solution to the meshgrid problem</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#Solver">Solver</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#What-for?">What for?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="apidoc-build/mods.html">Packages documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Build and deploy.html">Build and Deploy</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">City Pooling</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>City Pooling Notebook</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/City Pooling.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 5ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="City-Pooling-Notebook">
<h1>City Pooling Notebook<a class="headerlink" href="#City-Pooling-Notebook" title="Permalink to this headline">¶</a></h1>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="Problem-statement">
<h3>Problem statement<a class="headerlink" href="#Problem-statement" title="Permalink to this headline">¶</a></h3>
<p>This problem has been submitted by one of my colleagues. Besides being both a nice guy and a talented developper, he also is the president of the roller federation. He therefore has to sometimes participate in the construction of french roller hockey tournaments.</p>
<p>That is where he sometimes is faced with quite a challenge: dividing dozens of teams from various cities into smaller groups, which will then compete in round-robin tournaments. The problem is that he must try to be as efficient as possible when it comes to the cost of travel for each team. The cost of a scenario may be something as simple as the sum of total distance traveled by the teams, but it can also get far more complicated when trying to add some fairness to it: - trying to minimze the
distance run by the team with the greatest one - adding other criteria to the cost function: adding the standard deviation of total distance for each team to the overall cost - putting some weight over the “richest” teams by considering the cost of distance being smaller for them…</p>
<p>The simplest case would be minimizing total distance run by all teams, and after analysis: given points on a plane, how do I split them in same size groups so that total distance between points in the same group is minimized?</p>
<p><img alt="title" src="_images/16_cities.png" /></p>
<center><p>Example of 16 cities to split into 4 pools of 4</p>
</center></div>
<div class="section" id="Why-does-this-problem-seem-interesting-to-me?">
<h3>Why does this problem seem interesting to me?<a class="headerlink" href="#Why-does-this-problem-seem-interesting-to-me?" title="Permalink to this headline">¶</a></h3>
<p>Besides the immediate reward of being helpful to a colleague, the more I gave thought to this problem, the more I noticed that it presents many nice aspects: - being kind of “trading salesman”-ish, it looks like it would be an endless playground for optimization - furthermore, many python functionalities and libraries might get involved: iterators and generators, decorators, graphical tools from matplotlib and seaborn, file writing and reading to get some persistence, calls to Google Maps API to
work on real life data… - last but not least, when I first got to see some solutions on problem small enough to be <em>brutally</em> solved, I noticed that I could have had them simplified (sometimes solved!) just by looking at it. I might in the end get some Machine Learning algorithms working on this subject.</p>
</div>
<div class="section" id="Disclaimer">
<h3>Disclaimer<a class="headerlink" href="#Disclaimer" title="Permalink to this headline">¶</a></h3>
<p>I am definitely not a professional developper (yet?), and my sometimes cumbersome logic or alien syntax might make seasoned readers cringe. I definitely am open to any suggestion as to improve the following.</p>
</div>
<div class="section" id="Imports">
<h3>Imports<a class="headerlink" href="#Imports" title="Permalink to this headline">¶</a></h3>
<p>The below imports are used in this notebook (yet this would require some cleansing as some of them are not required here anymore).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># imports</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="k">import</span> <span class="n">LogNorm</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">combinations</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">cycle</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="k">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">factorial</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../../src/&#39;</span><span class="p">))</span>
<span class="kn">import</span> <span class="nn">geography.geography</span> <span class="k">as</span> <span class="nn">geo</span>
<span class="kn">import</span> <span class="nn">solver.scorer</span> <span class="k">as</span> <span class="nn">scorer</span>
<span class="kn">import</span> <span class="nn">importlib</span>
</pre></div>
</div>
</div>
<p>As I update as I go the packages where the classes are defined, the lines below enable to reload my packages without having to restart the whole kernel.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># cell to reload modules</span>
<span class="k">def</span> <span class="nf">reload_all</span><span class="p">():</span>
    <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">geo</span><span class="p">)</span>
    <span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">scorer</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="Geography">
<h2>Geography<a class="headerlink" href="#Geography" title="Permalink to this headline">¶</a></h2>
<div class="section" id="What-for?">
<h3>What for?<a class="headerlink" href="#What-for?" title="Permalink to this headline">¶</a></h3>
<p>First of all, I will define a class that will hold the distance cost between cities. For the first run of optimization, I will work with cost between two cities being the distance between them. That will enable me to visually check whether my code is possibly giving acurate results or being completely dumb.</p>
<p>I want that class to allow me to - create a map of cities from coordinates, or randomly set one up - assign them names - compute the distance matrix between every couple of cities - show a visual representation of the map - apply and give a visual representation of a configuration - compute the cost of a configuration</p>
<p>This class will then be extended as to get real data, for example from the Google Maps APIs.</p>
</div>
<div class="section" id="Class-definition">
<h3>Class definition<a class="headerlink" href="#Class-definition" title="Permalink to this headline">¶</a></h3>
<p>Class definition is all set up in the <code class="docutils literal notranslate"><span class="pre">geography.geography</span></code> module.</p>
</div>
<div class="section" id="Examples">
<h3>Examples<a class="headerlink" href="#Examples" title="Permalink to this headline">¶</a></h3>
<div class="section" id="Constructor-and-show-method">
<h4>Constructor and <code class="docutils literal notranslate"><span class="pre">show</span></code> method<a class="headerlink" href="#Constructor-and-show-method" title="Permalink to this headline">¶</a></h4>
<div class="section" id="Random-constructor">
<h5>Random constructor<a class="headerlink" href="#Random-constructor" title="Permalink to this headline">¶</a></h5>
<p>Constructor without parameters will just create a random map of n cities with default names, and compute the distance matrix with the “natural” euclidean distance. Explaination of the distance matrix is provided in the second example.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">geog</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">geography</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="n">geog</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">show_names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dist_matrix_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;annot&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(&lt;matplotlib.axes._subplots.AxesSubplot at 0x235968545c8&gt;,
 &lt;matplotlib.axes._subplots.AxesSubplot at 0x23595f0d5c8&gt;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/City_Pooling_7_1.png" src="_images/City_Pooling_7_1.png" />
</div>
</div>
</div>
<div class="section" id="Forced-coordinates-constructor">
<h5>Forced coordinates constructor<a class="headerlink" href="#Forced-coordinates-constructor" title="Permalink to this headline">¶</a></h5>
<p>It is also possible to force cities coordinates with a numpy array of shape (2, n) or the names of the cities with an iterable of names. Here, I will create a meshgrid of 16 cities, with a unit space of 1 between cities.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="n">pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span> <span class="p">)</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;0. Paris&quot;</span><span class="p">,</span>
    <span class="s2">&quot;1. Montpellier&quot;</span><span class="p">,</span>
    <span class="s2">&quot;2. Marseille&quot;</span><span class="p">,</span>
    <span class="s2">&quot;3. Bordeaux&quot;</span><span class="p">,</span>
    <span class="s2">&quot;4. Lyon&quot;</span><span class="p">,</span>
    <span class="s2">&quot;5. Lille&quot;</span><span class="p">,</span>
    <span class="s2">&quot;6. Rennes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;7. Clermont-Ferrand&quot;</span><span class="p">,</span>
    <span class="s2">&quot;8. Aix en Provence&quot;</span><span class="p">,</span>
    <span class="s2">&quot;9. Toulouse&quot;</span><span class="p">,</span>
    <span class="s2">&quot;10. Perpignan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;11. Pau&quot;</span><span class="p">,</span>
    <span class="s2">&quot;12. Orléans&quot;</span><span class="p">,</span>
    <span class="s2">&quot;13. Dijon&quot;</span><span class="p">,</span>
    <span class="s2">&quot;14. Metz&quot;</span><span class="p">,</span>
    <span class="s2">&quot;15. Nancy&quot;</span>
<span class="p">]</span>

<span class="n">geog</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">geography</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">cities_coordinates</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span> <span class="n">cities_names</span><span class="o">=</span><span class="n">names</span><span class="p">)</span>
<span class="n">geog</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">show_names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dist_matrix_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;annot&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>(&lt;matplotlib.axes._subplots.AxesSubplot at 0x23595e7bdc8&gt;,
 &lt;matplotlib.axes._subplots.AxesSubplot at 0x23595e95088&gt;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/City_Pooling_9_1.png" src="_images/City_Pooling_9_1.png" />
</div>
</div>
<p>In this example, you can see that distance from <code class="docutils literal notranslate"><span class="pre">0.</span> <span class="pre">Paris</span></code> to <code class="docutils literal notranslate"><span class="pre">1.</span> <span class="pre">Montpellier</span></code> is 1. As Euclidean distance is symetrical (dist(a,b) = dist(b,a)), so is the distance matrix.</p>
<p>I could have limited the distance matrix to its superior half, but I might encounter cases where going form a to b is longer (or more costly) than getting from b to a.</p>
</div>
</div>
<div class="section" id="show_config-method">
<h4><code class="docutils literal notranslate"><span class="pre">show_config</span></code> method<a class="headerlink" href="#show_config-method" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">show_config</span></code> method enables to apply a configuration to a geography, and display it.</p>
<p>A configuration is a dict :</p>
<ul class="simple">
<li><p>with integer keys</p></li>
<li><p>with iterables of city indexes as values</p></li>
</ul>
<p>As per the problem definition, a city index should only appear in a single pool, and only once in that pool, yet no restriction has been set in the source code.</p>
<div class="section" id="show_config-with-pools-as-set">
<h5><code class="docutils literal notranslate"><span class="pre">show_config</span></code> with pools as set<a class="headerlink" href="#show_config-with-pools-as-set" title="Permalink to this headline">¶</a></h5>
<p>A way to modelize a pool would be a python set, as it enforces the fact that inside a pool, a city may only appear once. Yet it has a serious drawback.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">geog</span><span class="o">.</span><span class="n">show_config</span><span class="p">({</span><span class="mi">0</span> <span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">1</span><span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">]),</span> <span class="mi">2</span><span class="p">:</span> <span class="nb">set</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">10</span><span class="p">])},</span> <span class="n">show_names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">dist_matrix_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;annot&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/City_Pooling_12_0.png" src="_images/City_Pooling_12_0.png" />
</div>
</div>
<p>The first cities in the first set were <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">:</span> <span class="pre">set([2,6,1])</span></code> and therefore first pool in the reordered distance matrix should have been <code class="docutils literal notranslate"><span class="pre">2:</span> <span class="pre">Marseille,</span> <span class="pre">6:</span> <span class="pre">Rennes,</span> <span class="pre">1:</span> <span class="pre">Montpellier</span></code>.</p>
<p>Note that python sets are unordered, this is why in the distance matrix in the above example inside a pool no order is applied and results in <code class="docutils literal notranslate"><span class="pre">1:</span> <span class="pre">Montpellier,</span> <span class="pre">2:</span> <span class="pre">Marseille,</span> <span class="pre">6:</span> <span class="pre">Rennes</span></code></p>
</div>
<div class="section" id="show_config-with-pools-as-lists">
<h5><code class="docutils literal notranslate"><span class="pre">show_config</span></code> with pools as lists<a class="headerlink" href="#show_config-with-pools-as-lists" title="Permalink to this headline">¶</a></h5>
<p>If I want to maintain an order inside each pool - which I will want to do later on - I need to use lists (see just below).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">geog</span><span class="o">.</span><span class="n">show_config</span><span class="p">({</span><span class="mi">0</span> <span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">10</span><span class="p">]},</span> <span class="n">show_names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">dist_matrix_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;annot&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/City_Pooling_14_0.png" src="_images/City_Pooling_14_0.png" />
</div>
</div>
<p>Here, the order inside each pool has been kept.</p>
</div>
<div class="section" id="Why-choosing-configuration-to-be-a-dict-rather-than-another-iterable?">
<h5>Why choosing configuration to be a dict rather than another iterable?<a class="headerlink" href="#Why-choosing-configuration-to-be-a-dict-rather-than-another-iterable?" title="Permalink to this headline">¶</a></h5>
<p>It might seem weird to choose to use a dict rather than a list for a configuration. But in future works, if I try to work on pools which are not the same size, I will need to build an enumeration system (and therefore need to be able to get to a pool with an integer index).</p>
</div>
</div>
</div>
<div class="section" id="Random-and-optimal-solution-to-the-meshgrid-problem">
<h3>Random and optimal solution to the meshgrid problem<a class="headerlink" href="#Random-and-optimal-solution-to-the-meshgrid-problem" title="Permalink to this headline">¶</a></h3>
<p>Let’s now try to compare the (trivial) solution of this problem (a 4x4 grid is not much of a challenge!) and a random one. For this example, I will try to minimize the total distance traveled by all teams.</p>
<p>First, I need to create a random configuration.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rand_perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rand_perm</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">rand_perm</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rand_perm</span><span class="p">)</span>
<span class="n">rand_configuration</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">rand_perm</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="p">:</span><span class="mi">4</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rand_configuration</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15]
[ 1  3 11  7  8 15  4 10  6  2  9 12 14  0 13  5]
{0: [1, 3, 11, 7], 1: [8, 15, 4, 10], 2: [6, 2, 9, 12], 3: [14, 0, 13, 5]}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">geog</span><span class="o">.</span><span class="n">show_config</span><span class="p">(</span><span class="n">rand_configuration</span><span class="p">,</span> <span class="n">show_names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">dist_matrix_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;annot&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/City_Pooling_18_0.png" src="_images/City_Pooling_18_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">geog</span><span class="o">.</span><span class="n">show_config</span><span class="p">({</span><span class="mi">0</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">],</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">]},</span> <span class="n">show_names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">dist_matrix_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;annot&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/City_Pooling_19_0.png" src="_images/City_Pooling_19_0.png" />
</div>
</div>
<p>One nice thing to notice is that finding a solution to the problem consists in permuting the cities in pools so that the lightest cells in the distance matrix get closest to the diagonal.</p>
</div>
</div>
<div class="section" id="Solver">
<h2>Solver<a class="headerlink" href="#Solver" title="Permalink to this headline">¶</a></h2>
<div class="section" id="What-for?">
<h3>What for?<a class="headerlink" href="#What-for?" title="Permalink to this headline">¶</a></h3>
<p>Obviously, to solve the problem! That means: find the configuration that minimize my criterion cost.</p>
<p>The solver package will have some submodules: - a <code class="docutils literal notranslate"><span class="pre">scorer</span></code> module, that will provide costing functions and compute the cost of a configuration applied to a geography - a <code class="docutils literal notranslate"><span class="pre">scoring_funcs</span></code> module, which will be a library of various scoring functions - a <code class="docutils literal notranslate"><span class="pre">solver</span></code> module, that will provide various algorithms to find a globally or locally optimal solution to the problem</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">myScorer</span> <span class="o">=</span> <span class="n">scorer</span><span class="o">.</span><span class="n">scorer</span><span class="p">(</span><span class="n">geog</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">myScorer</span><span class="o">.</span><span class="n">score</span><span class="p">({</span><span class="mi">0</span> <span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="mi">1</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="mi">2</span><span class="p">:</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">],</span> <span class="mi">3</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">]}))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
3.414213562373095
</pre></div></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="apidoc-build/mods.html" class="btn btn-neutral float-right" title="src" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to City Pooling’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Pierre Massé

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>